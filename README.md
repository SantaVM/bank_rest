# Система управления банковскими картами
(Credit Card Management System)

## Основные возможности

1. **Аутентификация и авторизация**
    - Пользователи авторизуются по email и паролю.
    - Доступ к API осуществляется через JWT токен в заголовке HTTP запроса.

2. **Функции пользователя**
    - Просмотр своих карт с параметризованным поиском и постраничной выдачей.
    - Запрос на блокировку карты.
    - Переводы между собственными картами (если пользователь владеет более одной картой).

3. **Функции администратора**
    - Создание, блокировка, активация и удаление карт.
    - Просмотр всех карт в системе.
    - Управление пользователями и их ролями.

4. **Обработка ошибок и валидация**
    - Сервис корректно обрабатывает ошибки и возвращает информативные сообщения.
    - Входящие данные валидируются.

5. **Документация API**
    - API описан через OpenAPI/Swagger.
    - Swagger UI доступен по адресу: `http://localhost:8080/swagger-ui/index.html`.

6. **Технологии**
    - Java 17, Spring Boot, Spring Security.
    - PostgreSQL для хранения данных.
    - Миграции БД реализованы через Liquibase.

7. **Тестирование**
    - Реализованы базовые юнит-тесты для `CardController` и бизнес-логики 
      `CardService`.

---

## Запуск приложения

1. Убедитесь, что на системе установлены:
    - Maven
    - Docker и Docker Compose

2. Соберите проект и запустите сервис:

```bash
docker-compose up -d --remove-orphans
```

3. Перейдите в Swagger UI:  
   [http://localhost:8080/swagger-ui/index.html](http://localhost:8080/swagger-ui/index.html)

4. Для авторизации используйте одного из демонстрационных пользователей:

| Email             | Пароль    | Роль  |
|------------------|-----------|-------|
| email@email.com   | 12345678  | ADMIN |
| email1@email.com  | 12345678  | USER  |

> JWT токен нужно добавить в форму авторизации Swagger или в HTTP заголовок:  
> `Authorization: Bearer <token>` для последующих запросов.

---

## Ограничения и особенности тестирования

- Новые пользователи создаются с ролью `USER` по умолчанию.
- Имя и фамилия пользователя автоматически используются в поле `CardHolder` для карты (только латинские буквы).
- Администратор может изменять роль любого пользователя.
- Номера карт валидируются по алгоритму Луна. Для тестирования есть эндпоинт генерации валидных номеров.
- Дата действия карты не может быть раньше текущей.
- Баланс карты всегда должен вводиться с **двумя знаками после запятой** при
  всех
  операциях.

---

## Доступные без авторизации URL

| URL                     | Метод | Описание |
|-------------------------|-------|----------|
| `/api/v1/auth/login`    | POST  | Авторизация пользователя и получение JWT токена |
| `/api/v1/auth/sign-up`  | POST  | Регистрация нового пользователя |
